<html>
<head>
    <title>myCamper</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <style>
        #map {height: 80%; width: 100%;}
    </style>
</head>
<body>
<!--The div element for the map -->
<div id="map"></div>

<script>
var my_places = [];
</script>

<script type="module">
    import jos from './Takeout/Location History/Semantic Location History/2022/2022_JULY.json' assert {type: 'json'};
    //import jos from './Takeout/Location History/Semantic Location History/2015/2015_NOVEMBER.json' assert {type: 'json'};
    //console.log('lok',jos);
    for (const [k, v] of Object.entries(jos.timelineObjects)) {
      try {
        if ('placeVisit' in v) {
            my_places.push([{
                lat: v.placeVisit.centerLatE7/10000000, 
                lng: v.placeVisit.centerLngE7/10000000}, 
                v.placeVisit.location.name + ': ' + v.placeVisit.duration.startTimestamp,
                red
            ]);
        }
        else if ('activitySegment' in v) {
            my_places.push([{
                lat: v.activitySegment.startLocation.latitudeE7/10000000, 
                lng: v.activitySegment.startLocation.longitudeE7/10000000}, 
                v.activitySegment.duration.startTimestamp,
                gray
            ]);
            my_places.push([{
                lat: v.activitySegment.endLocation.latitudeE7/10000000, 
                lng: v.activitySegment.endLocation.longitudeE7/10000000}, 
                v.activitySegment.duration.startTimestamp,
                gray
            ]);
        }
      }
      catch(err) {
        console.log(err);
      }
    }
    //console.log('my_places', my_places);
</script>

<!-- 
 The `defer` attribute causes the callback to execute after the full HTML
 document has been parsed. For non-blocking uses, avoiding race conditions,
 and consistent behavior across browsers, consider loading using Promises
 with https://www.npmjs.com/package/@googlemaps/js-api-loader.
-->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap&v=weekly" defer></script>
<script>
gurl  ="https://photos.google.com/lr/album/AKcG9LvNtfAeJfZAQKtZ7BRm0U6Am9EOmGAPC4xCEpmdOVi8S2df84rFW_5xxu3KxsT2ZeuJDOxJ/photo/AKcG9LudxST7hivkzw_RQ42NMBQcU8SS-J6UipLGaKRtnksr70wVfTDREfiGZoHcQ0rx95bLaCq1"
gimg = "https://lh3.googleusercontent.com/lr/ANt_8_ZqrL4uEIX6pMAs_fUdHlO_GJG8pfNRqpr2W8klIrlqJZTlwyHRk7jSi4Nqk8XwvCF551NASO0KSRzCOsgoA-7pqx-x8qFPRAe_55xEnk5OEKCdsOORIC_L8JM7I65_iol2NS0-OukQ0O_kDYXETx-ctECOrAC1wkaZXIwlwJVoPUQmYBlRMqe0DJr7EUkozk2g7eb8Md4OfR4QARWb_9y_IlwZRQpcof8nW9cy7EqoE_UBMgnvjQVhS5UEIEfoYUWYZZvg5ECHocSd9lTyRyucnxYeQKVUtlMGr3EQpG3-LKyUQJUszbG9EC3_rR5cLvdenALmYW-g-fFTKtNdFfmSs40vEqF-bTvEVfJVC0dvYqV2PcNHOem00JqfLJahl5ySP7Um8KKz6bJQp8coS54lSebakbbI05cKUraq0QXqO6OtGqEdtYkqb8R4tt7Y1EUSVUHNj04FbfLhxz1oJNMFS0Tmf8hqEi0LRlhJd62ahyetZjL9YkrPsaYY72BAwI78Iu7d8fx8eC6N_HmYLj7P2y9mSkCgXT2EkdaJLX2l-ELp0dTf7hK7ph-VIyQ5gD-uRJnG-_lV1-ZDMe1uNHlLRF4oT2V_lRcdgRaUVlAmglXTVis4UeR7tAjc0VHU7h7oc5FWx00v9D6qFi6ie9wwHgoxugVi04gqefw1GcKp20thB9EO20a4T4Ypcjn-HC3Hi95N917SgFzhb1h9ykiuYpDFN78rpOGAK_mH8BXH-PWZ92mUP2l1D0lb5-VVx6OgYboRGRaecl1H3sJ2x3_TowTqOgCE-6Z6PaK5s3smeycRweDlncaknonOaXZn686etjImXsT_T-R4MYJB7NdVE3aIhAp_bi8paBBLDtXiv14qTP0L68ZX_hut-C7j5NNVb6sTe8OWB8lnO4c3KHjNdxw9g-gr8ha7";
red = "img/red.png";
gray = "img/gray.png";
// Initialize and add the map
function initMap() {
    console.log('places', my_places);
    const uluru = {"lat": 45.5185957,"lng": 6.799915};
    const start_place = my_places[0][0];
    const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 10, center: start_place,
    });
    // Create an info window to share between markers.
    const infoWindow = new google.maps.InfoWindow();
    tourPathCoordinates = [];
    // Create the markers.
    my_places.forEach(([position, title, ico], i) => {
        tourPathCoordinates.push(position);
        const marker = new google.maps.Marker({
            position,
            map,
            title: `${i}. ${title}`,
            label: `${i}`,
            optimized: false,
            icon: ico
        });
        // Add a click listener for each marker, and set up the info window.
        marker.addListener("click", () => {
            infoWindow.close();
            content = marker.getTitle();
            content += '<br><a href="' + gurl +'" target="photos.google.com">';
            content += '<img src="' + gimg + '"></a>';
            infoWindow.setContent(content);
            infoWindow.open(marker.getMap(), marker);
        });
    });

    tourPath = new google.maps.Polyline({
        path: tourPathCoordinates,
        geodesic: true,
        strokeColor: "#202020",
        strokeOpacity: 0.4,
        strokeWeight: 2
    });
    tourPath.setMap(map);
}
window.initMap = initMap;
</script>
</body>
</html>